create_package("/Users/josephdescallar/Documents/My R packages/phcshMPL")
library(devtools)
create_package("/Users/josephdescallar/Documents/My R packages/phcshMPL")
8/146
1/146
5/146
2/146
8/60
library(devtools)
check()
check()
use_package("survival")
use_r("phcsh_mpl_control")
check()
check()
check()
check()
document()
document()
?phcsh_mpl
survivalMPL::coxph_mpl()
survivalMPL::coxph_mpl
?survivalMPL::coxph_mpl
document()
?phcsh_mpl
document()
?phcsh_mpl
?survivalMPL::coxph_mpl
document()
?phcsh_mpl
?survivalMPL::coxph_mpl
document()
?phcsh_mpl
?survivalMPL::coxph_mpl
use_package("statmod")
use_package("splines2")
check()
check()
check()
check()
check()
check()
check()
check()
check()
check()
check()
check()
check()
use_package("Matrix")
check()
check()
check()
check()
check()
check()
check()
library(Matrix)
check()
check()
check()
check()
check()
check()
check()
check()
check()
check()
check()
use_package("utils")
check()
check()
check()
check()
check()
use_r("plot.phcsh_mpl")
use_r("plot_phcsh_mpl")
check()
check()
check()
check()
check()
check()
check()
use_r("summary_phcsh_mpl")
check()
use_package("stats")
check()
document()
check()
check()
check()
check()
gen.cric.data <- function(n.datasets = 1000, n.obs = 200, prob_event = 0.2, rho = 3, lambda1 = 1,
lambda2 = 0.5, betas = list(c(0.5,-2), c(1,-1)), gammaL = 0.5, gammaR = 2.5){
simdata <- list()
for(sim in 1:n.datasets){
b11 <- betas[[1]][1]
b12 <- betas[[1]][2]
b21 <- betas[[2]][1]
b22 <- betas[[2]][2]
seed <- sim
set.seed(seed)
#Generate U~unif(0,1)
u <- runif(n.obs)
#Generate x1 and x2
#x1 <- runif(n.obs, 0, 2)
#x2 <- rbinom(n.obs, 1, 0.5)
x1 <- rnorm(n.obs, mean=0, sd=1)
x2 <- rnorm(n.obs, mean=0, sd=1)
#x2 <- runif(n.obs, 0, 2)
x <- data.matrix(data.frame(x1,x2))
#Calculate t random variable
t <- (-log(u) / (lambda1*exp(x1*b11 + x2*b12) + lambda2*(exp(x1*b21 + x2*b22))))^(1/rho)
Ul <- runif(n.obs)
Ur <- runif(n.obs,Ul,1)
Ue <- runif(n.obs)
event <- ifelse(Ue < prob_event,1,ifelse(gammaL*Ul <= t & t <= gammaR*Ur,3,ifelse(t < gammaL*Ul,2,0)))
#Generate V to determine which risk t belongs
p1 <- (lambda1*exp(x1*b11 + x2*b12)) / ((lambda1*exp(x1*b11 + x2*b12) + lambda2*(exp(x1*b21 + x2*b22))))
p2 <- (lambda2*exp(x1*b21 + x2*b22)) / ((lambda1*exp(x1*b11 + x2*b12) + lambda2*(exp(x1*b21 + x2*b22))))
v <- runif(n.obs)
time1 <- ifelse(event==0,gammaR*Ur,ifelse(event==1,t,ifelse(event==2,gammaL*Ul,gammaL*Ul)))
time2 <- ifelse(event==0,NA,ifelse(event==1,t,ifelse(event==2,NA,gammaR*Ur)))
tmid <- ifelse(event==3,rowMeans(cbind(time1,time2)),ifelse(event==2,time1/2, time1))
risk <- ifelse(event==0,NA,ifelse(v <= p1, 1, 2))
risk_1 <- ifelse((event==1 | event==2 | event==3) & risk == 1, 1, 0)
risk_2 <- ifelse((event==1 | event==2 | event==3) & risk == 2, 1, 0)
risk2 <- ifelse(is.na(risk),0,risk)
x <- data.frame(x1,x2)
simdata[[sim]] <- data.frame("time"=time1,time2,x,event,risk,tmid,risk2,t,risk_1,risk_2)
}
simdata
}
install()
use_package("Surv")
document()
document()
document()
document()
document()
library(devtools)
document()
install()
gen.cric.data <- function(n.datasets = 1000, n.obs = 200, prob_event = 0.2, rho = 3, lambda1 = 1,
lambda2 = 0.5, betas = list(c(0.5,-2), c(1,-1)), gammaL = 0.5, gammaR = 2.5){
simdata <- list()
for(sim in 1:n.datasets){
b11 <- betas[[1]][1]
b12 <- betas[[1]][2]
b21 <- betas[[2]][1]
b22 <- betas[[2]][2]
seed <- sim
set.seed(seed)
#Generate U~unif(0,1)
u <- runif(n.obs)
#Generate x1 and x2
#x1 <- runif(n.obs, 0, 2)
#x2 <- rbinom(n.obs, 1, 0.5)
x1 <- rnorm(n.obs, mean=0, sd=1)
x2 <- rnorm(n.obs, mean=0, sd=1)
#x2 <- runif(n.obs, 0, 2)
x <- data.matrix(data.frame(x1,x2))
#Calculate t random variable
t <- (-log(u) / (lambda1*exp(x1*b11 + x2*b12) + lambda2*(exp(x1*b21 + x2*b22))))^(1/rho)
Ul <- runif(n.obs)
Ur <- runif(n.obs,Ul,1)
Ue <- runif(n.obs)
event <- ifelse(Ue < prob_event,1,ifelse(gammaL*Ul <= t & t <= gammaR*Ur,3,ifelse(t < gammaL*Ul,2,0)))
#Generate V to determine which risk t belongs
p1 <- (lambda1*exp(x1*b11 + x2*b12)) / ((lambda1*exp(x1*b11 + x2*b12) + lambda2*(exp(x1*b21 + x2*b22))))
p2 <- (lambda2*exp(x1*b21 + x2*b22)) / ((lambda1*exp(x1*b11 + x2*b12) + lambda2*(exp(x1*b21 + x2*b22))))
v <- runif(n.obs)
time1 <- ifelse(event==0,gammaR*Ur,ifelse(event==1,t,ifelse(event==2,gammaL*Ul,gammaL*Ul)))
time2 <- ifelse(event==0,NA,ifelse(event==1,t,ifelse(event==2,NA,gammaR*Ur)))
tmid <- ifelse(event==3,rowMeans(cbind(time1,time2)),ifelse(event==2,time1/2, time1))
risk <- ifelse(event==0,NA,ifelse(v <= p1, 1, 2))
risk_1 <- ifelse((event==1 | event==2 | event==3) & risk == 1, 1, 0)
risk_2 <- ifelse((event==1 | event==2 | event==3) & risk == 2, 1, 0)
risk2 <- ifelse(is.na(risk),0,risk)
x <- data.frame(x1,x2)
simdata[[sim]] <- data.frame("time"=time1,time2,x,event,risk,tmid,risk2,t,risk_1,risk_2)
}
simdata
}
library(survival)
#create dataset
cric.scen1.r47.n200 <- gen.cric.data(n.datasets = 1000, n.obs = 200,
prob_event = 0.05, rho = 3, lambda1 = 1, lambda2 = 1,
betas = list(c(1,0.5), c(0.5,0.5)), gammaL = 0.5, gammaR = 0.91)
test.package <- phcsh_mpl(Surv(time, time2, event=event, "interval") ~ x1 + x2,
risk = cric.scen1.r47.n200[[1]]$risk,
data = cric.scen1.r47.n200[[1]], max.outer = 10, max.iter = 3000,
lambda = c(1e-5,1e-5), n.basis = NULL, iknots.pos = NULL, aps = TRUE,
knots.perc.limit = c(0.05,0.95), tmid = TRUE, iter.disp = TRUE)
summary_phcsh_mpl(test.package, SAND=FALSE)
summary_phcsh_mpl(test.package)
plot_phcsh_mpl(test.package)
requireNamespace("survival", quietly = TRUE)
library(devtools)
use_dev_package("survival")
library(devtools)
library(phcshMPL)
install()
library(phcshMPL)
cric.scen1.r47.n200[[1]]
library(phcshMPL)
#create dataset
cric.scen1.r47.n200 <- gen.cric.data(n.datasets = 1000, n.obs = 200,
prob_event = 0.05, rho = 3, lambda1 = 1, lambda2 = 1,
betas = list(c(1,0.5), c(0.5,0.5)), gammaL = 0.5, gammaR = 0.91)
source("~/Documents/PhD/CSH Interval/generate data for testing package.R", echo=TRUE)
test.package <- phcsh_mpl(Surv(time, time2, event=event, "interval") ~ x1 + x2,
risk = cric.scen1.r47.n200[[1]]$risk,
data = cric.scen1.r47.n200[[1]], max.outer = 10, max.iter = 3000,
lambda = c(1e-5,1e-5), n.basis = NULL, iknots.pos = NULL, aps = TRUE,
knots.perc.limit = c(0.05,0.95), tmid = TRUE, iter.disp = TRUE)
#create dataset
cric.scen1.r47.n200 <- gen.cric.data(n.datasets = 1000, n.obs = 200,
prob_event = 0.05, rho = 3, lambda1 = 1, lambda2 = 1,
betas = list(c(1,0.5), c(0.5,0.5)), gammaL = 0.5, gammaR = 0.91)
test.package <- phcsh_mpl(Surv(time, time2, event=event, "interval") ~ x1 + x2,
risk = cric.scen1.r47.n200[[1]]$risk,
data = cric.scen1.r47.n200[[1]], max.outer = 10, max.iter = 3000,
lambda = c(1e-5,1e-5), n.basis = NULL, iknots.pos = NULL, aps = TRUE,
knots.perc.limit = c(0.05,0.95), tmid = TRUE, iter.disp = TRUE)
document()
install()
library(phcshMPL)
test.package <- phcsh_mpl(Surv(time, time2, event=event, "interval") ~ x1 + x2,
risk = cric.scen1.r47.n200[[1]]$risk,
data = cric.scen1.r47.n200[[1]], max.outer = 10, max.iter = 3000,
lambda = c(1e-5,1e-5), n.basis = NULL, iknots.pos = NULL, aps = TRUE,
knots.perc.limit = c(0.05,0.95), tmid = TRUE, iter.disp = TRUE)
usethis::use_dev_package("survival")
install()
library(phcshMPL)
test.package <- phcsh_mpl(Surv(time, time2, event=event, "interval") ~ x1 + x2,
risk = cric.scen1.r47.n200[[1]]$risk,
data = cric.scen1.r47.n200[[1]], max.outer = 10, max.iter = 3000,
lambda = c(1e-5,1e-5), n.basis = NULL, iknots.pos = NULL, aps = TRUE,
knots.perc.limit = c(0.05,0.95), tmid = TRUE, iter.disp = TRUE)
document()
test.package <- phcsh_mpl(Surv(time, time2, event=event, "interval") ~ x1 + x2,
risk = cric.scen1.r47.n200[[1]]$risk,
data = cric.scen1.r47.n200[[1]], max.outer = 10, max.iter = 3000,
lambda = c(1e-5,1e-5), n.basis = NULL, iknots.pos = NULL, aps = TRUE,
knots.perc.limit = c(0.05,0.95), tmid = TRUE, iter.disp = TRUE)
document()
document()
test.package <- phcsh_mpl(Surv(time, time2, event=event, "interval") ~ x1 + x2,
risk = cric.scen1.r47.n200[[1]]$risk,
data = cric.scen1.r47.n200[[1]], max.outer = 10, max.iter = 3000,
lambda = c(1e-5,1e-5), n.basis = NULL, iknots.pos = NULL, aps = TRUE,
knots.perc.limit = c(0.05,0.95), tmid = TRUE, iter.disp = TRUE)
summary_phcsh_mpl(test.package)
library(phcshMPL)
document()
install()
library(phcshMPL)
use_r(phcsh_mpl_cf)
use_r("phcsh_mpl_cf")
use_r("phcshcf_mpl")
check()
check()
check()
survivalMPL::plot.coxph_mpl
?survivalMPL::plot.coxph_mpl
document()
check()
document()
check()
check()
check()
?survivalMPL::summary.coxph_mpl
check()
check()
check()
check()
document()
check()
check()
use_package_doc("survival")
check()
document()
check()
use_r("phcshcf_mpl_control")
?survivalMPL::coxph_mpl.control
check()
check()
check()
check()
check()
check()
check()
check()
check()
check()
check()
check()
install()
